
# 囲碁AI 勝率表示ソフト - Sabaki for ISC


# 概要

![screenshot](./img/screenshot.png)

囲碁AIを使った検討や勝率の表示を行いながら、囲碁対局を検討するためのソフトウェアです。竜星戦や囲碁プレミアムなどで検討が行えるよう、既存の囲碁検討ソフトである [Sabaki](https://github.com/SabakiHQ/Sabaki) を改修し、囲碁将棋チャンネル用に新たな機能を追加しています。このマニュアルでは主にその追加機能に関しての説明を行います。

基本的な操作方法などは [Sabaki](https://github.com/SabakiHQ/Sabaki) に準じます。より詳しくは [美しいい囲碁GUIソフト「Sabaki」](http://betago.hateblo.jp/entry/2018/01/18/041210) や [GTP対応AIとの対戦も可能、美しさにこだわったオープンソースの囲碁ソフト「Sabaki」](https://forest.watch.impress.co.jp/docs/review/1114356.html) などを参考にして下さい。


## 基本的な操作方法

- **石を置く**：　マウスで石を置く交点を左クリック
- **置いた石を削除**：　盤面上の配置してある石の上で左クリック
- **手を戻す**：　マウス上ホイール ／ キーボード上キー
- **手を進める**：　マウス下ホイール ／ キーボード下キー
- **盤面を移動**：　右側に配置されたノードの丸を左クリック



# 対局検討の仕組み

![対局検討の仕組み](./img/system.png)

- **解説室**： 本譜とAIによる勝率などを参考にしながら解説を行います。解説では対局室で入力された本譜の手を自動で読み込むため、何もせず最新の手を見ることができます。また、検討モードでは自由に石を置き検討を行えます。
- **対局室**： 室内にいる記録係／読上げ係による本譜の入力を行います。ソフトに手を入力すると棋譜の変更が解説室や収録室に伝わります。



# デザイン画面

![デザイン画面](./img/design.png)

デザイン画面は視聴者に見せるための画面です。背景画像と白番バー画像を変更することで様々なデザインを実現できるようになっています。囲碁AIによる候補手と各候補手の勝率も表示されます。

デザイン画面は操作用画面とは別のウィンドウで表示します。このウィンドウのみを別ディスプレイに出力することで、配信画面などにデザイン画面全体を取り込むことができます。


## デザインウィンドウの操作方法

- **ウィンドウを表示する**：　メインメニューの「AI用メニュー」から「デザイン画面を表示する」をクリックすることでデザインウィンドウを表示します。
- **ウィンドウの最大化**：　右クリックメニューから「最大化」を選択します　／　ダブルクリック
- **ウィンドウを元のサイズに戻す**：　右クリックメニューから「元に戻す」を選択します　／　ダブルクリック
- **ウィンドウの移動**：　ウィンドウ内でマウスをドラッグします。
- **ウィンドウのリサイズ**：　ウィンドウ外側をドラッグします。
- **ウィンドウを閉じる**：　右クリックメニューから「閉じる」を選択します


## デザイン画面表示の仕組み

![背景画像説明](./img/design-system.png)

デザイン画面では上図のように背景画像の上に白番用の勝率バー画像を重ねて表示することで、黒番・白番バーを動かせるようにしています。黒勝勢のときは上に重なっている白番バーの画像の表示領域を小さくすることで、背景画像に描かれた黒番バーの表示を大きくしています。逆に白優勢のときは白番バー画像の表示範囲を広くし、背景画像に描かれた黒番バーを塗りつぶすようにしています。


## 背景画像作成時の注意点

- <font color="red">背景画像には黒番バーを表示した状態で画像を出力してください。また、白番バーは一切表示しないようにしてください。</font>
- <font color="red">白番バー画像では白番バーの部分のみを描き、その他の部分は透明化するようにしてください。また、Photoshopなどでレイヤ分けしている場合は、白番バーをレイヤの一番上に持っていき、他のレイヤで隠された部分がないかを確認してから画像を出力してください。</font>


## デザイン画面・検討中

![デザイン画面・検討中](./img/design-commentary.png)

検討モードでは勝率の表示が消えます。また、検討時に打った石にはマークがつき本譜ではないということがすぐにわかるようになっています。



# メインメニュー: AI用メニュー

![メインメニュー: AI用メニュー](./img/mainmenu-ai.png)

- **管理者用サイドバーを表示**：　管理者用サイドバーを表示します。
- **解説用サイドバーを表示**：　解説者時に使うサイドバーを表示します。
- **本譜入力用サイドバーを表示**：　本譜入力時に使うサイドバーを表示します。
- **デザインウィンドウを表示**：　デザイン画面を表示するためのウィンドウを表示します。
- **デザイン設定を読み込み**：　管理者用サイドバーで設定したデザイン周りの設定をファイルから読み込みます。
- **デザイン設定を保存**：　デザイン周りの設定をファイルに保存します。


# 管理者用サイドバー


## AWSを起動・AWSを停止

![AWSを起動・AWSを停止](./img/mainsidebar-aws.png)

- **AWSを起動**：　囲碁AIを動かすためのクラウドコンピューターをAWS上に起動します。AWSの状態は右下のテキストに表示されます。
- **AWSを停止**：　AWSのクラウドコンピューターを停止します。

|  AWSの各状態     |          状態の説明                             |
| ---------------- | --------------------------------------------- |  
| **AWS未起動**       | AWSのクラウドコンピューターが起動されていません。 |  
| **AWS起動準備中**   | AWSのクラウドコンピューターが起動準備中です。<br>しばらくたつとコンピューターが起動されます。 |  
| **AWS起動中**       | AWSのクラウドコンピューターが起動中です。 |  
| **AWS停止中**       | AWSのクラウドコンピューターを停止中です。<br>しばらくたつとコンピューターが未起動状態になります。 |  
| **AWSでエラー発生** | AWSで何らかのエラーが発生しました。<br>AWSを停止するか、ソフトの再起動などを試してみてください。 |


## アプリ終了時の確認

![アプリ終了時](./img/closing.png)

AWS起動中・AWS起動準備中にアプリを終了しようとすると上記のようなダイアログが出ます。もし必要であればAWSを停止してからアプリを終了してください。


## 画像設定

![画像設定](./img/mainsidebar-image.png)

- **背景画像**：　デザイン画面に表示される背景画像を設定します。
- **白番用の勝率バー画像**：　デザイン画面で表示される勝率バーの白番用画像を設定します。


## 候補手表示

![候補手表示](./img/mainsidebar-heatmap.png)

- **黒番の勝率を左側に表示**：　黒番の勝率を左側に表示します。チェックが入っていない場合は黒番の勝率が右側に表示され、それに合わせて勝率バーの表示も入れ替わります。
- **候補手を表示**：　デザイン画面上に候補手を表示します。
- **石や候補手の表示テストを行う**：　デザイン画面上にテスト用の盤面と候補手を表示します。
- **テストで表示する勝率**：　表示テストを行っているときに表示する勝率を設定します。


## 盤表示・勝率表示

![盤表示・勝率表示](./img/mainsidebar-board.png)

- **デザイン画面に碁盤を表示**：　デザイン画面に碁盤を表示するか設定します。
- **左端の座標、上端の座標、右端の座標、下端の座標**：　デザイン画面上に表示する碁盤の座標を設定します。設定は左上を0%, 右下を100%とした座標値のパーセントで行います。
- **デザイン画面に勝率を表示**：　デザイン画面に勝率の数値を表示するか設定します。
- **黒番の表示位置[X], 黒番の表示位置[Y]**：　黒番の勝率の数値を表示するX,Y座標を設定します。座標は背景画像のサイズにおけるピクセル値で指定します。
- **白番の表示位置[X], 白番の表示位置[Y]**：　白番の勝率の数値を表示するX,Y座標を設定します。座標は背景画像のサイズにおけるピクセル値で指定します。


## 棋譜ファイル

![棋譜ファイル](./img/mainsidebar-record.png)

- **棋譜ファイル**：　本譜を保存・読み込む先の棋譜ファイルを設定します。棋譜入力モードではこのファイルに棋譜を保存します。対局観戦モード・検討モードでは棋譜の読み込み先となるファイルとなります。



# 解説用サイドバー

![解説用サイドバー](./img/commentarysidebar.png)

- **対局観戦モード**：　対局観戦モードに移行します。このモードでは入力された本譜の手を監視し、もし変更があれば盤面を最新局面に自動的に移動します。AIによる検討盤面も最新局面に自動的に移動します。また、ユーザーが手を進めたり戻したりすることは一切できず、閲覧のみのモードになります。

- **検討モード**：　検討モードに移行します。このモードでは検討したい手を自由に打つことができます。AIによる検討盤面は読み込んでいる本譜の最新盤面で固定され、もしアプリ上の盤面を動かした場合でも勝率や候補手などは変化しません。また、検討中に打った手にはマークがつき、本譜ではない手ということがすぐ分かるようになっています。

- **通常モード**：　本譜の読み込みなどをやめます。また、囲碁AIは表示盤面を検討するようになります。



# 本譜入力用サイドバー

![本譜入力用サイドバー](./img/recordsidebar.png)

- **棋譜入力モード**：　本譜入力用のモードになります。手を入力した場合や手を戻した場合は、棋譜が自動的に管理用サイドバーで設定した棋譜ファイルに自動的に保存されます。
- **最終着手**：　最後に着手した石の手番と座標を表示します。


## 本譜入力モードの注意点

- <font color="red">打つ手を間違えたり盤面を戻した場合でも、それがそのまま本譜として反映され盤面の検討が行われます。操作ミスなどはなるべくしないよう気を付けてください。</font>
